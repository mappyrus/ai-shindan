<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 心と体の根本原因診断</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            scroll-behavior: smooth;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .form-section, .report-section {
            background-color: white;
            padding: 1.5rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            margin-bottom: 2rem;
        }
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            border-left: 4px solid #3b82f6;
            padding-left: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .question-group {
             margin-bottom: 1.5rem;
        }
        .question-label {
            display: block;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.75rem;
        }
        .rating-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .rating-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 0.25rem;
        }
        .rating-label input {
            margin-bottom: 0.25rem;
        }
        /* 結果表示アニメーション */
        .fade-in {
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100">


    <!-- ★★★ 変更点: 十分な余白を追加 ★★★ -->
    <div id="main-container" class="container mx-auto max-w-3xl p-4 sm:p-6 pb-32">
       
        <header class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">AI 心と体の根本原因診断</h1>
            <p class="text-gray-600 mt-2 max-w-2xl mx-auto">なぜか続く心と体の不調。その「本当の原因」を知り、根本から解決しませんか？<br>AIがあなたの状態を多角的に分析し、新しい一歩を提案します。</p>
        </header>


        <form id="diag-form">


            <!-- A. 基本情報 -->
            <div class="form-section">
                <h2 class="section-title">A. 基本情報</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">ニックネーム <span class="text-red-500">*</span></label>
                        <input type="text" id="name" name="name" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="age" class="block text-sm font-medium text-gray-700">年齢</label>
                        <input type="number" id="age" name="age" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">性別</label>
                        <div class="flex items-center space-x-4 mt-2">
                            <label><input type="radio" name="gender" value="男性" class="text-blue-600 focus:ring-blue-500"> 男性</label>
                            <label><input type="radio" name="gender" value="女性" class="text-blue-600 focus:ring-blue-500"> 女性</label>
                            <label><input type="radio" name="gender" value="その他" class="text-blue-600 focus:ring-blue-500"> その他</label>
                        </div>
                    </div>
                    <div>
                        <label for="height" class="block text-sm font-medium text-gray-700">身長 (cm)</label>
                        <input type="number" step="0.1" id="height" name="height" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="weight" class="block text-sm font-medium text-gray-700">現在体重 (kg)</label>
                        <input type="number" step="0.1" id="weight" name="weight" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                     <div class="md:col-span-2 bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-medium text-center text-gray-700 mb-2">体重の目安</h3>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-center">
                            <div><span class="text-xs text-gray-500">BMI</span><p id="bmi-val" class="font-bold text-lg">-</p></div>
                            <div><span class="text-xs text-gray-500">判定</span><p id="bmi-judge" class="font-bold text-lg">-</p></div>
                            <div><span class="text-xs text-gray-500">標準体重(22)</span><p id="std-weight" class="font-bold text-lg">- kg</p></div>
                            <div><span class="text-xs text-gray-500">理想体重(20)</span><p id="ideal-weight" class="font-bold text-lg">- kg</p></div>
                        </div>
                    </div>
                     <div>
                        <label for="target-weight" class="block text-sm font-medium text-gray-700">あなたの目標体重 (kg)</label>
                        <input type="number" step="0.1" id="target-weight" name="target-weight" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>


            <!-- B. 身体・精神症状チェック -->
            <div class="form-section">
                <h2 class="section-title">B. 症状チェック (5=深刻 〜 1=無し)</h2>
                <!-- 身体症状 -->
                <div class="question-group p-4 bg-blue-50 rounded-lg mb-4">
                    <h3 class="font-semibold mb-3 text-blue-800">身体の不調</h3>
                    <div class="space-y-3">
                        <div class="question-group"><label class="question-label">B1. 日中のだるさ・疲労感が強い</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b1" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b1" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b1" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b1" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b1" value="5">5</label> </div></div>
                        <div class="question-group"><label class="question-label">B2. 胃もたれ・膨満感を感じる</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b2" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b2" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b2" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b2" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b2" value="5">5</label> </div></div>
                        <div class="question-group"><label class="question-label">B3. 便秘・下痢など腸の不調が続く</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b3" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b3" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b3" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b3" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b3" value="5">5</label> </div></div>
                        <div class="question-group"><label class="question-label">B4. 風邪・感染症にかかりやすい</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b4" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b4" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b4" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b4" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b4" value="5">5</label> </div></div>
                        <div class="question-group"><label class="question-label">B5. 糖尿病など重大な慢性疾患がある、またはその恐れがある</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b5" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b5" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b5" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b5" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b5" value="5">5</label> </div></div>
                    </div>
                </div>
                <!-- 精神症状 -->
                 <div class="question-group p-4 bg-green-50 rounded-lg">
                    <h3 class="font-semibold mb-3 text-green-800">精神の不調（トラウマ反応）</h3>
                     <div class="space-y-3">
                        <div class="question-group"><label class="question-label">B6. 怒りやイライラがコントロールできない</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b6" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b6" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b6" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b6" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b6" value="5">5</label> </div></div>
                        <div class="question-group"><label class="question-label">B7. 不安・恐怖が頭から離れない</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b7" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b7" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b7" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b7" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b7" value="5">5</label> </div></div>
                        <div class="question-group"><label class="question-label">B8. 過去のつらい記憶が突然よみがえる</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b8" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b8" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b8" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b8" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b8" value="5">5</label> </div></div>
                        <div class="question-group"><label class="question-label">B9. 自己肯定感が低い／無価値感がある</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b9" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b9" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b9" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b9" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b9" value="5">5</label> </div></div>
                        <div class="question-group"><label class="question-label">B10. 気分の浮き沈みが激しい（躁鬱的）</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b10" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b10" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b10" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b10" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b10" value="5">5</label> </div></div>
                        <div class="question-group"><label class="question-label">B11. 人付き合いが苦手・億劫に感じる</label><div class="rating-group"> <label class="rating-label"><input type="radio" name="symptom_b11" value="1">1</label> <label class="rating-label"><input type="radio" name="symptom_b11" value="2">2</label> <label class="rating-label"><input type="radio" name="symptom_b11" value="3">3</label> <label class="rating-label"><input type="radio" name="symptom_b11" value="4">4</label> <label class="rating-label"><input type="radio" name="symptom_b11" value="5">5</label> </div></div>
                    </div>
                </div>
            </div>
           
             <!-- C. 食生活スクリーニング -->
            <div class="form-section">
                <h2 class="section-title">C. 食生活の現状 (5=よく当てはまる 〜 1=全く当てはまらない)</h2>
                 <!-- 動物食品 -->
                <div class="question-group p-4 bg-red-50 rounded-lg mb-4">
                    <h3 class="font-semibold mb-3 text-red-800">動物性食品について</h3>
                    <div class="space-y-3">
                     <div class="question-group"><label class="question-label">C1. 赤身肉・加工肉をよく食べる</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c1" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c1" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c1" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c1" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c1" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C2. 鶏肉をよく食べる</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c2" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c2" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c2" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c2" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c2" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C3. 魚介類をよく食べる</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c3" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c3" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c3" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c3" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c3" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C4. 牛乳・ヨーグルト・チーズなどの乳製品を摂る</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c4" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c4" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c4" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c4" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c4" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C5. 卵を摂る</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c5" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c5" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c5" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c5" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c5" value="5">5</label></div></div>
                    </div>
                </div>
                 <!-- 糖質 -->
                <div class="question-group p-4 bg-yellow-50 rounded-lg mb-4">
                    <h3 class="font-semibold mb-3 text-yellow-800">糖質の多い食品について</h3>
                     <div class="space-y-3">
                     <div class="question-group"><label class="question-label">C6. お米（白米、玄米など）をよく食べる</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c6" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c6" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c6" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c6" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c6" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C7. パン（菓子パン、全粒粉パン含む）をよく食べる</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c7" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c7" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c7" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c7" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c7" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C8. 麺類（パスタ, うどん等）やピザなど小麦製品をよく食べる</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c8" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c8" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c8" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c8" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c8" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C9. 砂糖入り菓子・ジュース・清涼飲料水をよく摂る</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c9" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c9" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c9" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c9" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c9" value="5">5</label></div></div>
                    </div>
                </div>
                 <!-- その他 -->
                <div class="question-group p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-semibold mb-3 text-gray-800">食習慣について</h3>
                     <div class="space-y-3">
                     <div class="question-group"><label class="question-label">C10. 化学調味料・加工食品を避けられていない</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c10" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c10" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c10" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c10" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c10" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C11. 夜20時以降に食事や間食をすることがある</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c11" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c11" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c11" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c11" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c11" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C12. 食事の頻度が1日3回以上だ</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c12" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c12" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c12" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c12" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c12" value="5">5</label></div></div>
                     <div class="question-group"><label class="question-label">C13. 食事の量が多いと感じる、または減らしたいと思っている</label><div class="rating-group"><label class="rating-label"><input type="radio" name="diet_c13" value="1">1</label> <label class="rating-label"><input type="radio" name="diet_c13" value="2">2</label> <label class="rating-label"><input type="radio" name="diet_c13" value="3">3</label> <label class="rating-label"><input type="radio" name="diet_c13" value="4">4</label> <label class="rating-label"><input type="radio" name="diet_c13" value="5">5</label></div></div>
                    </div>
                </div>
            </div>
           
            <!-- D, E, F. 意欲と優先順位 -->
            <div class="form-section">
                <h2 class="section-title">D, E, F. 取り組みへの意欲と優先順位</h2>


                <!-- トラウマノート -->
                <div class="question-group p-4 bg-green-50 rounded-lg mb-4">
                     <h3 class="font-semibold mb-3 text-green-800">トラウマ解消（トラウマノート）について</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                           <label class="question-label">D1. トラウマノートの経験</label>
                           <select name="trauma_d1" class="w-full mt-1 border-gray-300 rounded-md">
                               <option value="">選択してください</option>
                               <option value="実践中">毎日・または定期的に実践している</option>
                               <option value="時々">時々やっている</option>
                               <option value="これから">これから始めたい</option>
                               <option value="興味あり">興味はあるが、少し怖い・不安</option>
                               <option value="やらない">やらない／知らない</option>
                           </select>
                        </div>
                        <div>
                           <label class="question-label">D2. トラウマに向き合う覚悟</label>
                           <div class="rating-group"><label class="rating-label text-xs">弱い<input type="radio" name="trauma_d2" value="1">1</label> <label class="rating-label text-xs"><input type="radio" name="trauma_d2" value="2">2</label> <label class="rating-label text-xs"><input type="radio" name="trauma_d2" value="3">3</label> <label class="rating-label text-xs"><input type="radio" name="trauma_d2" value="4">4</label> <label class="rating-label text-xs">強い<input type="radio" name="trauma_d2" value="5">5</label></div>
                        </div>
                         <div>
                            <label class="question-label">D3. 食改善よりトラウマを優先したいか</label>
                           <div class="rating-group"><label class="rating-label text-xs">食事優先<input type="radio" name="trauma_d3" value="1">1</label> <label class="rating-label text-xs"><input type="radio" name="trauma_d3" value="2">2</label> <label class="rating-label text-xs"><input type="radio" name="trauma_d3" value="3">3</label> <label class="rating-label text-xs"><input type="radio" name="trauma_d3" value="4">4</label> <label class="rating-label text-xs">トラウマ優先<input type="radio" name="trauma_d3" value="5">5</label></div>
                         </div>
                         <div>
                            <label class="question-label">D4. 希望するサポート</label>
                           <select name="trauma_d4" class="w-full mt-1 border-gray-300 rounded-md">
                               <option value="">選択してください</option>
                               <option value="カウンセラー">専門家（カウンセラー）のサポートが必要</option>
                               <option value="グループ">グループでのサポート機会がほしい</option>
                               <option value="自己解決">情報だけもらい、自分で解決したい</option>
                           </select>
                         </div>
                     </div>
                </div>


                <!-- 食改善 -->
                <div class="question-group p-4 bg-red-50 rounded-lg mb-4">
                     <h3 class="font-semibold mb-3 text-red-800">食改善への意欲 (5=今すぐやりたい 〜 1=まだ無理)</h3>
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">ヴィーガン化（動物食をやめる）</h4>
                            <div class="space-y-3">
                                <!-- ★★★ 変更点: スマホ対応 ★★★ -->
                               <div class="flex flex-col items-start sm:flex-row sm:justify-between sm:items-center"><label class="mb-2 sm:mb-0">肉類(牛,豚,鶏)</label><div class="rating-group w-full sm:w-40"><label class="rating-label text-xs"><input type="radio" name="vegan_e1" value="1">1</label><label class="rating-label text-xs"><input type="radio" name="vegan_e1" value="2">2</label><label class="rating-label text-xs"><input type="radio" name="vegan_e1" value="3">3</label><label class="rating-label text-xs"><input type="radio" name="vegan_e1" value="4">4</label><label class="rating-label text-xs"><input type="radio" name="vegan_e1" value="5">5</label></div></div>
                               <div class="flex flex-col items-start sm:flex-row sm:justify-between sm:items-center"><label class="mb-2 sm:mb-0">魚介類</label><div class="rating-group w-full sm:w-40"><label class="rating-label text-xs"><input type="radio" name="vegan_e2" value="1">1</label><label class="rating-label text-xs"><input type="radio" name="vegan_e2" value="2">2</label><label class="rating-label text-xs"><input type="radio" name="vegan_e2" value="3">3</label><label class="rating-label text-xs"><input type="radio" name="vegan_e2" value="4">4</label><label class="rating-label text-xs"><input type="radio" name="vegan_e2" value="5">5</label></div></div>
                               <div class="flex flex-col items-start sm:flex-row sm:justify-between sm:items-center"><label class="mb-2 sm:mb-0">乳製品</label><div class="rating-group w-full sm:w-40"><label class="rating-label text-xs"><input type="radio" name="vegan_e3" value="1">1</label><label class="rating-label text-xs"><input type="radio" name="vegan_e3" value="2">2</label><label class="rating-label text-xs"><input type="radio" name="vegan_e3" value="3">3</label><label class="rating-label text-xs"><input type="radio" name="vegan_e3" value="4">4</label><label class="rating-label text-xs"><input type="radio" name="vegan_e3" value="5">5</label></div></div>
                               <div class="flex flex-col items-start sm:flex-row sm:justify-between sm:items-center"><label class="mb-2 sm:mb-0">卵</label><div class="rating-group w-full sm:w-40"><label class="rating-label text-xs"><input type="radio" name="vegan_e4" value="1">1</label><label class="rating-label text-xs"><input type="radio" name="vegan_e4" value="2">2</label><label class="rating-label text-xs"><input type="radio" name="vegan_e4" value="3">3</label><label class="rating-label text-xs"><input type="radio" name="vegan_e4" value="4">4</label><label class="rating-label text-xs"><input type="radio" name="vegan_e4" value="5">5</label></div></div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">糖質制限（穀物・砂糖をやめる）</h4>
                             <div class="space-y-3">
                               <div class="flex flex-col items-start sm:flex-row sm:justify-between sm:items-center"><label class="mb-2 sm:mb-0">お米（白米・玄米など）</label><div class="rating-group w-full sm:w-40"><label class="rating-label text-xs"><input type="radio" name="sugar_e1" value="1">1</label><label class="rating-label text-xs"><input type="radio" name="sugar_e1" value="2">2</label><label class="rating-label text-xs"><input class="rating-label" type="radio" name="sugar_e1" value="3">3</label><label class="rating-label text-xs"><input type="radio" name="sugar_e1" value="4">4</label><label class="rating-label text-xs"><input type="radio" name="sugar_e1" value="5">5</label></div></div>
                               <div class="flex flex-col items-start sm:flex-row sm:justify-between sm:items-center"><label class="mb-2 sm:mb-0">パン・麺類(小麦製品)</label><div class="rating-group w-full sm:w-40"><label class="rating-label text-xs"><input type="radio" name="sugar_e2" value="1">1</label><label class="rating-label text-xs"><input type="radio" name="sugar_e2" value="2">2</label><label class="rating-label text-xs"><input type="radio" name="sugar_e2" value="3">3</label><label class="rating-label text-xs"><input type="radio" name="sugar_e2" value="4">4</label><label class="rating-label text-xs"><input type="radio" name="sugar_e2" value="5">5</label></div></div>
                               <div class="flex flex-col items-start sm:flex-row sm:justify-between sm:items-center"><label class="mb-2 sm:mb-0">砂糖・菓子・甘い飲物</label><div class="rating-group w-full sm:w-40"><label class="rating-label text-xs"><input type="radio" name="sugar_e3" value="1">1</label><label class="rating-label text-xs"><input type="radio" name="sugar_e3" value="2">2</label><label class="rating-label text-xs"><input type="radio" name="sugar_e3" value="3">3</label><label class="rating-label text-xs"><input type="radio" name="sugar_e3" value="4">4</label><label class="rating-label text-xs"><input type="radio" name="sugar_e3" value="5">5</label></div></div>
                            </div>
                        </div>
                      </div>
                </div>


                <!-- 優先順位 -->
                <div class="question-group p-4 bg-gray-50 rounded-lg">
                     <h3 class="font-semibold mb-3 text-gray-800">この1ヶ月の優先順位</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                           <label class="question-label">F1. 最も優先したいこと</label>
                           <div class="space-y-1">
                               <label class="flex items-center"><input type="radio" name="priority_f1" value="食事" class="mr-2"> 食事改善に集中したい</label>
                               <label class="flex items-center"><input type="radio" name="priority_f1" value="トラウマ" class="mr-2"> トラウマ解消に集中したい</label>
                               <label class="flex items-center"><input type="radio" name="priority_f1" value="両方" class="mr-2"> 両方ともバランス良く進めたい</label>
                               <label class="flex items-center"><input type="radio" name="priority_f1" value="未定" class="mr-2"> 診断結果を見て決めたい</label>
                           </div>
                        </div>
                     </div>
                </div>
            </div>


            <!-- 送信ボタン -->
            <div class="text-center mt-6">
                <button type="submit" id="submit-button" class="bg-blue-600 text-white font-bold py-3 px-12 rounded-full hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:scale-100">
                    診断してプランを受け取る
                </button>
            </div>
        </form>
       
        <!-- 待機メッセージエリア -->
        <div id="result-area" class="text-center mt-8 hidden">
             <div class="flex justify-center mb-4"> <div class="loader"></div> </div>
            <p id="result-message" class="text-gray-700 font-medium text-lg"></p>
        </div>
       
        <!-- レポート表示エリア -->
        <div id="report-display-area" class="hidden">
             <div class="report-section fade-in">
                 <h2 class="text-2xl font-bold text-center text-gray-800 mb-2">診断レポート</h2>
                 <p class="text-center text-gray-600 mb-6" id="report-user-name"></p>
                 <div class="bg-blue-50 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-800 border-b-2 border-blue-200 pb-2 mb-3">AIからのメッセージ</h3>
                    <p id="report-summary" class="text-gray-700 whitespace-pre-wrap leading-relaxed"></p>
                 </div>
             </div>
             <div class="report-section fade-in" style="animation-delay: 0.2s;">
                 <h3 class="text-xl font-bold text-gray-800 text-center mb-6">あなたへの推奨プラン</h3>
                 <div id="report-plans" class="space-y-8">
                     <!-- ここにプランが動的に挿入されます -->
                 </div>
             </div>
             
             <!-- 次へのステップ案内 -->
             <div class="fade-in" style="animation-delay: 0.4s;">
                <div class="text-center p-8 mb-6 border-2 border-blue-500 rounded-xl shadow-lg bg-white">
                    <h3 class="text-xl font-bold text-blue-800 mb-3">「エンドゥ・オンラインサロン」に参加されていない皆さんへ</h3>
                    <p class="text-gray-700 mb-6 max-w-xl mx-auto">
                        この診断ツールは、元々「エンドゥ・オンラインサロン」の参加者向けに開発されたものですが、より多くの方に自分と向き合うきっかけを提供したいと考え、この度、外部にも公開することにしました。<br>
                        もし、あなたが偶然この診断に出会い、結果に心当たりがあったなら、それは変化のサインかもしれません。一人で悩まず、専門家や仲間と共に着実に変化を遂げたいなら、私たちのオンラインサロンがあなたを待っています。
                    </p>
                    <a href="https://pink677956.studio.site/" target="_blank" rel="noopener noreferrer" class="inline-block bg-blue-600 text-white font-bold py-3 px-10 rounded-full shadow-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-110">
                        エンドゥ・オンラインサロン2025年一期生募集を詳しく見る
                    </a>
                </div>
           
                <div class="text-center p-8 border-2 border-purple-500 rounded-xl shadow-lg bg-white">
                    <h3 class="text-xl font-bold text-purple-800 mb-3">特に、トラウマ解消に強く関心がある方へ</h3>
                    <p class="text-gray-700 mb-6 max-w-xl mx-auto">
                        今回の診断で、特に感情面や過去の経験と向き合うことの重要性が示唆されたあなたへ。専門家による、より深いサポートをご案内します。<br>
                        「かずみのトラウマノート解消」サロンは、トラウマ解消を専門的に扱っています。エンドゥ・オンラインサロンと併用することで、食事と心の両面から、より効果的にアプローチできます。もちろん、こちらのサロンから始めてみるのも素晴らしい選択です。
                    </p>
                    <a href="https://lounge.dmm.com/detail/9373/index/" target="_blank" rel="noopener noreferrer" class="inline-block bg-purple-600 text-white font-bold py-3 px-10 rounded-full shadow-lg hover:bg-purple-700 transition-all duration-300 transform hover:scale-110">
                        「かずみのトラウマノート解消」サロンを詳しく見る
                    </a>
                </div>
            </div>


        </div>


    </div>


    <script>
        const form = document.getElementById('diag-form');
        const submitButton = document.getElementById('submit-button');
        const resultArea = document.getElementById('result-area');
        const resultMessage = document.getElementById('result-message');
        const reportDisplayArea = document.getElementById('report-display-area');
        const heightInput = document.getElementById('height');
        const weightInput = document.getElementById('weight');


        // BMI自動計算
        function calculateBmi() {
            const height = parseFloat(heightInput.value);
            const weight = parseFloat(weightInput.value);
            const bmiValEl = document.getElementById('bmi-val');
            const bmiJudgeEl = document.getElementById('bmi-judge');
            const stdWeightEl = document.getElementById('std-weight');
            const idealWeightEl = document.getElementById('ideal-weight');


            if (height > 0 && weight > 0) {
                const heightInM = height / 100;
                const bmi = weight / (heightInM * heightInM);
                bmiValEl.textContent = bmi.toFixed(1);


                if (bmi < 18.5) bmiJudgeEl.textContent = '痩せぎみ';
                else if (bmi < 25) bmiJudgeEl.textContent = '標準';
                else if (bmi < 30) bmiJudgeEl.textContent = '肥満気味';
                else bmiJudgeEl.textContent = '肥満';


                stdWeightEl.textContent = (22 * heightInM * heightInM).toFixed(1) + ' kg';
                idealWeightEl.textContent = (20 * heightInM * heightInM).toFixed(1) + ' kg';
            } else {
                 bmiValEl.textContent = '-';
                 bmiJudgeEl.textContent = '-';
                 stdWeightEl.textContent = '- kg';
                 idealWeightEl.textContent = '- kg';
            }
        }
        heightInput.addEventListener('input', calculateBmi);
        weightInput.addEventListener('input', calculateBmi);


        form.addEventListener('submit', async (e) => {
            e.preventDefault();
           
            form.classList.add('hidden');
            resultArea.classList.remove('hidden');
            window.scrollTo(0, 0);
            resultMessage.textContent = 'AIがあなたの状態を分析し、レポートを作成中です...';


            try {
                // 1. レポート生成
                const { postData, scores } = collectAndScoreData();
                const prompt = createPrompt(postData, scores);
                const aiReport = await generateAiReport(prompt);
               
                // 2. レポートを画面に表示
                displayReport(postData.name, aiReport);
                resultArea.classList.add('hidden');
                reportDisplayArea.classList.remove('hidden');


            } catch (error) {
                console.error('処理中にエラー:', error);
                form.classList.remove('hidden');
                resultArea.classList.add('hidden');
                alert(`レポートの生成中にエラーが発生しました: ${error.message}\nもう一度お試しください。`);
            }
        });




        /**
         * レポートを画面に表示する関数
         * @param {string} userName - ユーザー名
         * @param {object} report - AIが生成したレポートオブジェクト
         */
        function displayReport(userName, report) {
            document.getElementById('report-user-name').textContent = `${userName}さんのための`;
            document.getElementById('report-summary').textContent = report.summary;


            const plansContainer = document.getElementById('report-plans');
            plansContainer.innerHTML = ''; // コンテナをクリア


            report.plans.forEach(plan => {
                const planHtml = `
                    <div class="border-l-4 border-blue-500 pl-6">
                        <h4 class="text-xl font-semibold text-gray-800 mb-2">${plan.title}</h4>
                        <p class="text-gray-600 mb-4">${plan.description}</p>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                           <li><strong>Week1:</strong> ${plan.W1}</li>
                           <li><strong>Week2:</strong> ${plan.W2}</li>
                           <li><strong>Week3:</strong> ${plan.W3}</li>
                           <li><strong>Week4:</strong> ${plan.W4}</li>
                        </ul>
                    </div>
                `;
                plansContainer.innerHTML += planHtml;
            });
        }




        /**
         * フォームからデータを収集し、診断スコアを計算する
         */
        function collectAndScoreData() {
            const formData = new FormData(form);
            const postData = Object.fromEntries(formData.entries());
           
            const getScore = (name) => parseInt(formData.get(name) || 0, 10);


            const scores = {
                physicalSymptom: getScore('symptom_b1') + getScore('symptom_b2') + getScore('symptom_b3') + getScore('symptom_b4') + getScore('symptom_b5'),
                mentalSymptom: getScore('symptom_b6') + getScore('symptom_b7') + getScore('symptom_b8') + getScore('symptom_b9') + getScore('symptom_b10') + getScore('symptom_b11'),
                animalProduct: getScore('diet_c1') + getScore('diet_c2') + getScore('diet_c3') + getScore('diet_c4') + getScore('diet_c5'),
                sugarIntake: getScore('diet_c6') + getScore('diet_c7') + getScore('diet_c8') + getScore('diet_c9'),
                badHabits: getScore('diet_c10') + getScore('diet_c11') + getScore('diet_c12') + getScore('diet_c13'),
                traumaMotivation: getScore('trauma_d2') + getScore('trauma_d3'),
                veganMotivation: getScore('vegan_e1') + getScore('vegan_e2') + getScore('vegan_e3') + getScore('vegan_e4'),
                sugarFreeMotivation: getScore('sugar_e1') + getScore('sugar_e2') + getScore('sugar_e3')
            };
           
            return { postData, scores };
        }


        /**
         * AIに送るプロンプトを生成する
         */
        function createPrompt(data, scores) {
            return `
あなたは、食事とトラウマ解消を通じて利用者のウェルネスを支援するオンラインサロンの専門アドバイザーです。
以下のユーザー情報を深く分析し、その人に寄り添った、具体的で実行可能な2種類の「1ヶ月改善プラン」を提案してください。


# ユーザー情報
## 基本プロフィール
- ニックネーム: ${data.name}
- 年齢: ${data.age || '未設定'}
- 性別: ${data.gender || '未設定'}
- 身長/体重: ${data.height || '未設定'}cm / ${data.weight || '未設定'}kg
- 目標体重: ${data['target-weight'] || '未設定'}kg


## 診断スコア（高いほど課題が大きい）
- 身体的症状スコア: ${scores.physicalSymptom} / 25
- 精神的症状スコア: ${scores.mentalSymptom} / 30
- 動物性食品の摂取スコア: ${scores.animalProduct} / 25
- 糖質の摂取スコア: ${scores.sugarIntake} / 20
- 乱れた食習慣スコア: ${scores.badHabits} / 20


## 取り組みへの意欲
- トラウマ解消への覚悟と優先度: ${scores.traumaMotivation} / 10
- ヴィーガン化への意欲: ${scores.veganMotivation} / 20
- 糖質制限への意欲: ${scores.sugarFreeMotivation} / 15
- 自己申告の優先順位: ${data.priority_f1 || '未設定'}
- トラウマノート経験: ${data.trauma_d1 || '未設定'}


# 指示
上記の情報を基に、以下のルールに従って回答を生成してください。
1.  **共感と要約**: まずはユーザーの状況に共感し、診断結果をポジティブな言葉で要約してください。これを "summary" に記述します。
2.  **2つのプラン提案**: ユーザーの課題の大きさ（スコア）と意欲を考慮し、最も効果的だと思われる2つの異なるプランを "plans" 配列に格納します。
    -   **プランの考慮事項**:
        -   **トラウマ優先**: 精神的症状スコアが非常に高く、本人がトラウマ解消を優先したい場合、1つは「トラウマノート集中プラン」とし、食事改善はごく緩やかなものにしてください。トラウマケアの負荷を考慮することが重要です。
        -   **食事優先**: 食事関連のスコアが高く、本人の意欲も高い場合、「ヴィーガン移行プラン」や「糖質制限プラン」を具体的に提案します。
        -   **バランス**: スコアが全体的に高く、本人が「両方」を望む場合、食事とトラウマケアを両立するが、負荷が高すぎないプランを提案します。
        -   **意欲を尊重**: 本人の意欲スコアが高い項目を優先的にプランに組み込んでください。
3.  **プラン内容**: 各プランは "title", "description"（なぜこのプランを勧めるかの説明）, "W1", "W2", "W3", "W4" のキーを持つオブジェクトにしてください。4週間のステップは具体的に、かつ実行可能なレベルで記述してください。
4.  **出力形式**: 必ず以下のJSON形式で、日本語で回答してください。
5.  **穀物とタンパク質に関する重要ルール**: 糖質制限を提案する際は、**玄米や全粒粉も含め、全ての穀物（米、パン、麺類）は推奨しないでください。** 代わりに、**「穀物の代替として、タンパク質が豊富な豆類（大豆、レンズ豆、ひよこ豆）、豆腐、ナッツ類を食事に取り入れる」**という具体的な提案を必ず含めてください。このルールは絶対です。
6.  **食事頻度に関する重要ルール**: **朝食を食べる、1日3食しっかり食べる、といった一般的な常識を提案に含めないでください。** 代わりに**「1日2食以下（特に朝食抜き）」「1日1食」**、そして**「空腹でなければ無理に食べない」**という考えを尊重し、それをポジティブな選択肢として提案に含めてください。体の声を聞くことの重要性を伝えてください。このルールも絶対です。


\`\`\`json
{
  "summary": "（ここ診断結果の要約と励ましのメッセージを150字程度で記述）",
  "plans": [
    {
      "title": "（プラン1のタイトル）",
      "description": "（なぜこのプランがあなたにお勧めなのかの説明）",
      "W1": "（1週目の具体的なアクション）",
      "W2": "（2週目の具体的なアクション）",
      "W3": "（3週目の具体的なアクション）",
      "W4": "（4週目の具体的なアクション）"
    },
    {
      "title": "（プラン2のタイトル）",
      "description": "（なぜこのプランがあなたにお勧めなのかの説明）",
      "W1": "（1週目の具体的なアクション）",
      "W2": "（2週目の具体的なアクション）",
      "W3": "（3週目の具体的なアクション）",
      "W4": "（4週目の具体的なアクション）"
    }
  ]
}
\`\`\`
`;
        }
       
        /**
         * AIレポートを生成する関数 (Gemini API)
         */
        async function generateAiReport(prompt) {
             const apiKey = "";
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
             const requestBody = {
                 contents: [{ parts: [{ text: prompt }] }],
                 generationConfig: { responseMimeType: "application/json" }
             };
             const response = await fetch(apiUrl, {
                 method: 'POST',
                 headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify(requestBody)
             });
             if (!response.ok) throw new Error(`AI APIエラー: ${response.statusText}`);
             const result = await response.json();
             if (result.candidates && result.candidates[0].content.parts[0].text) {
                const reportText = result.candidates[0].content.parts[0].text;
                try {
                    return JSON.parse(reportText);
                } catch(e) {
                    console.error("AIからのJSON応答の解析に失敗:", reportText);
                    throw new Error("AIからの応答形式が正しくありません。");
                }
             } else {
                console.error("無効なAI応答:", result);
                throw new Error("AIから有効なレポートを取得できませんでした。");
             }
        }
    </script>
</body>
</html>